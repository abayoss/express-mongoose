<div class="row">
    <div class="col s12 m8">
        {{!-- <h2>{{dream.title}}</h2> --}}
        <div class="card">
            <div class="card-image" style="max-height: 70vh;">
                <img src="{{dream.image}}" alt="{{dream.title}}" class="responsive-img"
                    style="height:-moz-available;height:-webkit-fill-available;object-fit:cover;">
                {{!-- <span class="card-title">
                    {{dream.title}}
                </span> --}}
                {{!-- floating button with helper: --}}
                <small>{{{ editIcon dream.creator.id user.id dream._id }}}</small>
                {{!-- floating button without helper: --}}
                {{!-- <a href="/dreams/edit/{{dream.id}}" class="btn-floating halfway-fab red">
                    <i class="fa fa-pencil" aria-hidden="true"></i>
                </a> --}}
            </div>
            <div class="card-content">
                <span class="card-title">
                    {{dream.title}}
                </span>
                <div class="row right-align">{{formatDate dream.date 'MMMM Do YYYY'}}</div>
                <div class="row right-align">
                    <button class="btn" onclick="readAloud()">
                        <i class="fa fa-volume-up" aria-hidden="true"></i>
                        read aloud !
                    </button>
                </div>
                <div class="card-action bodyToRead">
                    {{{dream.body}}}
                </div>
            </div>
        </div>
        {{!-- comments card --}}
        {{#if dream.allowComments}}
        <div class="card">
            <div class="card-content">
                <span class="card-title">Comments</span>
                {{#if user}}
                <form action="/dreams/comment/{{dream._id}}" method="post">
                    <div class="input-field">
                        <textarea name="commentBody" class="materialize-textarea"></textarea>
                        <label for="commentBody">Add comment</label>
                    </div>
                    <button class="btn waves-effect waves-light" type="submit" name="action">Submit
                    </button>
                </form>
                {{else}}
                <p>Please <a href="/Auth/login">Log</a> in to leave a comment </p>
                {{/if}}
            </div>
            {{#each dream.comments}}
            <div class="card-action">
                <h6>{{commentBody}}</h6>
                <div class="right-align">
                    <small>Posted {{formatDate commentDate 'MMMM Do YYYY'}} by : </small>
                    <div class="chip">
                        <img src="{{commentCreator.image}}" alt="Creator">
                        <a href="/dreams/user/{{commentCreator.id}}" class="black-text">
                            {{commentCreator.firstName}} {{CommentCreator.lastName}}
                        </a>
                    </div>
                </div>
            </div>
            {{/each}}
        </div>
        {{/if}}
    </div>
    {{!-- user card --}}
    <div class="col s12 m4">
        <div class="card">
            <a href="/dreams/user/{{dream.creator.id}}">
                <div class="card-content center-align">
                    <h4 class="center black-text">{{dream.creator.firstName}} {{dream.creator.lastName}}</h4>
                    <img src="{{dream.creator.image}}" alt="" class="circle responsive-img">
                </div>
                <div class="card-action center-align">
                    <a>Read More From {{dream.creator.firstName}}</a>
                </div>
            </a>
        </div>
        {{!-- Voting card --}}
        <div class="card center-align">
            <a {{#if user}} onclick="sendVote('{{dream._id}}',{{dream.currentUserDirection}}, 'upVote')" {{else}}
                href="/auth/login" {{/if}} id="upVote-{{dream._id}}"
                class=" {{#if dream.currentUserVotedUp }} purple-text {{else}} black-text {{/if}}"
                style="display: contents; cursor: pointer;">
                <i class="fa fa-chevron-up" aria-hidden="true"></i>
            </a>
            <p id="totalVotes-{{dream._id}}"
                data-key="{{#if dream.currentUserVotedUp }}up{{/if}}{{#if dream.currentUserVotedDown }}down{{/if}}">
                {{dream.totalVotes}}
            </p>
            <a {{#if user}} onclick="sendVote('{{dream._id}}', {{dream.currentUserDirection}},'downVote')" {{else}}
                href="/auth/login" {{/if}} id="downVote-{{dream._id}}"
                class=" {{#if dream.currentUserVotedDown }} red-text {{else}} black-text {{/if}}"
                style="display: contents;cursor: pointer;">
                <i class="fa fa-chevron-down" aria-hidden="true"></i>
            </a>
            <div class="card-action">Vote This dream</div>
        </div>
    </div>
</div>
<script src="/js/voting.js"></script>
<script>
    const readAloud = () => {
        const body = document.querySelector('.bodyToRead').children[0].innerText;
        const msg = new SpeechSynthesisUtterance(body);
        if (!window.speechSynthesis.speaking) {
            window.speechSynthesis.speak(msg);
        } else {
            window.speechSynthesis.cancel();
        }
    }
</script>